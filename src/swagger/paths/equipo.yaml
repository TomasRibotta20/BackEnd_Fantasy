/equipos/detalle-equipo/{equipoId}:
  get:
    summary: Obtiene el detalle completo de un equipo
    description: Recupera la información detallada de un equipo específico, incluyendo todos sus jugadores (titulares y suplentes), presupuesto, valores de cláusula y estado de protección. Solo accesible para usuarios que participan en el mismo torneo.
    tags: [Equipos]
    parameters:
      - in: path
        name: equipoId
        required: true
        schema:
          type: integer
        description: ID del equipo
        example: 1
    responses:
      200:
        description: Detalle del equipo recuperado exitosamente.
        content:
          application/json:
            schema:
              type: object
              properties:
                data:
                  type: object
                  properties:
                    id:
                      type: integer
                      example: 1
                    nombre:
                      type: string
                      example: 'Los Invencibles'
                    presupuesto:
                      type: number
                      example: 45000000
                      description: Presupuesto disponible del equipo
                    es_mio:
                      type: boolean
                      example: true
                      description: Indica si el equipo pertenece al usuario autenticado
                    torneo_usuario:
                      type: object
                      properties:
                        id:
                          type: integer
                        usuario:
                          type: object
                          properties:
                            id:
                              type: integer
                            username:
                              type: string
                        torneo:
                          type: object
                          properties:
                            id:
                              type: integer
                            nombre:
                              type: string
                        expulsado:
                          type: boolean
                    jugadores:
                      type: array
                      items:
                        type: object
                        properties:
                          id:
                            type: integer
                          es_titular:
                            type: boolean
                          fecha_incorporacion:
                            type: string
                            format: date-time
                          valor_clausula:
                            type: number
                            description: Valor base de la cláusula
                          valor_clausula_efectiva:
                            type: number
                            description: Valor efectivo de la cláusula (puede estar blindada)
                          dias_proteccion_restantes:
                            type: integer
                            nullable: true
                            description: Días restantes de protección contra cláusulas
                          esta_protegido:
                            type: boolean
                            description: Si el jugador está actualmente protegido
                          jugador:
                            type: object
                            properties:
                              id:
                                type: integer
                              nombre:
                                type: string
                              primer_nombre:
                                type: string
                              apellido:
                                type: string
                              foto:
                                type: string
                              precio_actual:
                                type: number
                              posicion:
                                type: object
                                properties:
                                  id:
                                    type: integer
                                  descripcion:
                                    type: string
                              club:
                                type: object
                                properties:
                                  id:
                                    type: integer
                                  nombre:
                                    type: string
                                  logo:
                                    type: string
      403:
        description: No tienes permisos para ver este equipo o estás expulsado del torneo.
      404:
        description: El equipo no existe.
      500:
        description: Error del servidor.

/equipos/todos:
  get:
    summary: Obtiene todos los equipos del sistema (solo administrador)
    description: Recupera una lista completa de todos los equipos registrados en la base de datos, ordenados por ID.
    tags: [Equipos]
    responses:
      200:
        description: Lista de equipos recuperada exitosamente.
        content:
          application/json:
            schema:
              type: array
              items:
                type: object
                properties:
                  id:
                    type: integer
                    example: 1
                  nombre:
                    type: string
                    example: 'Los Invencibles'
                  presupuesto:
                    type: number
                    example: 45000000
      500:
        description: Error del servidor.

/equipos/mi-equipo/{equipoId}/alineacion:
  patch:
    summary: Actualiza la alineación intercambiando un titular con un suplente
    description: Permite intercambiar las posiciones de un jugador titular y un suplente del mismo equipo. Ambos jugadores deben tener la misma posición. Requiere que las modificaciones estén habilitadas.
    tags: [Equipos]
    parameters:
      - in: path
        name: equipoId
        required: true
        schema:
          type: integer
        description: ID del equipo
        example: 1
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - jugadorTitularId
              - jugadorSuplenteId
            properties:
              jugadorTitularId:
                type: integer
                example: 45
                description: ID del jugador actualmente titular que pasará a suplente
              jugadorSuplenteId:
                type: integer
                example: 78
                description: ID del jugador actualmente suplente que pasará a titular
    responses:
      200:
        description: Alineación actualizada exitosamente.
        content:
          application/json:
            schema:
              type: object
              properties:
                message:
                  type: string
                  example: 'Alineación actualizada con éxito.'
      400:
        description: Error de validación.
        content:
          application/json:
            schema:
              type: object
              properties:
                message:
                  type: string
                  examples:
                    no_pertenecen:
                      value: 'Ambos jugadores deben pertenecer a tu equipo para ser intercambiados.'
                    no_titular:
                      value: 'El jugador con ID 45 no es titular.'
                    no_suplente:
                      value: 'El jugador con ID 78 no es suplente.'
                    posicion_diferente:
                      value: 'No se puede cambiar la alineación. El jugador titular es Attacker y el suplente es Defender.'
                    sin_posicion:
                      value: 'Ambos jugadores deben tener una posición definida.'
      403:
        description: No puedes modificar este equipo o estás expulsado del torneo.
      404:
        description: Equipo o jugador no encontrado.
      500:
        description: Error del servidor.

/equipos/mi-equipo/{equipoId}/cambiar-estado:
  patch:
    summary: Cambia el estado de titularidad de un jugador
    description: Permite promover un suplente a titular o bajar un titular a suplente. Al promover, valida los límites de la formación 4-3-3. Requiere que las modificaciones estén habilitadas.
    tags: [Equipos]
    parameters:
      - in: path
        name: equipoId
        required: true
        schema:
          type: integer
        description: ID del equipo
        example: 1
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - jugadorId
            properties:
              jugadorId:
                type: integer
                example: 45
                description: ID del jugador cuyo estado de titularidad se cambiará
    responses:
      200:
        description: Estado de titularidad cambiado exitosamente.
        content:
          application/json:
            schema:
              type: object
              properties:
                message:
                  type: string
                  examples:
                    a_suplente:
                      value: 'Jugador movido a suplente con éxito'
                    a_titular:
                      value: 'Jugador promovido a titular con éxito'
                data:
                  type: object
                  properties:
                    jugador:
                      type: object
                      properties:
                        id:
                          type: integer
                          example: 45
                        nombre:
                          type: string
                          example: 'L. Messi'
                        posicion:
                          type: string
                          example: 'Attacker'
                    estado_anterior:
                      type: string
                      enum: [titular, suplente]
                      example: 'suplente'
                    estado_nuevo:
                      type: string
                      enum: [titular, suplente]
                      example: 'titular'
                    estadisticas_posicion:
                      type: object
                      nullable: true
                      description: Solo aparece cuando se promociona a titular
                      properties:
                        posicion:
                          type: string
                          example: 'Attacker'
                        titulares_actuales:
                          type: integer
                          example: 3
                        limite_formacion:
                          type: integer
                          example: 3
                        espacios_disponibles:
                          type: integer
                          example: 0
      400:
        description: Error de validación.
        content:
          application/json:
            schema:
              type: object
              properties:
                message:
                  type: string
                  examples:
                    limite_excedido:
                      value: 'No puedes agregar más titulares en la posición Attacker. Límite de la formación 4-3-3: 3. Actualmente tienes 3 titular(es). Primero debes hacer suplente a otro jugador de esta posición.'
                    sin_posicion:
                      value: 'El jugador no tiene una posición definida'
                    posicion_invalida:
                      value: 'Posición inválida: Unknown'
      403:
        description: No puedes modificar este equipo o estás expulsado del torneo.
      404:
        description: Equipo o jugador no encontrado.
      500:
        description: Error del servidor.

/equipos/{equipoId}/historial:
  get:
    summary: Obtiene el historial completo de un equipo en todas las jornadas
    description: Recupera los snapshots y puntajes del equipo en todas las jornadas procesadas.
    tags: [Equipos]
    parameters:
      - in: path
        name: equipoId
        required: true
        schema:
          type: integer
        description: ID del equipo
        example: 1
    responses:
      200:
        description: Historial del equipo recuperado exitosamente.
        content:
          application/json:
            schema:
              type: object
              properties:
                message:
                  type: string
                  example: 'Historial obtenido'
                data:
                  type: array
                  items:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 1
                      puntaje_total:
                        type: number
                        example: 85.5
                      fecha_snapshot:
                        type: string
                        format: date-time
                      jornada:
                        type: object
                        properties:
                          id:
                            type: integer
                          nombre:
                            type: string
                            example: 'Fecha 10'
                          fecha_inicio:
                            type: string
                            format: date-time
      500:
        description: Error del servidor.

/equipos/{equipoId}/puntos/jornadas/{jornadaId}:
  get:
    summary: Obtiene el equipo y sus puntajes en una jornada específica
    description: Recupera el snapshot del equipo en una jornada particular, incluyendo jugadores titulares y suplentes con sus estadísticas y puntajes. Si es la jornada activa, muestra el equipo actual sin puntajes. Solo accesible para usuarios del mismo torneo.
    tags: [Equipos]
    parameters:
      - in: path
        name: equipoId
        required: true
        schema:
          type: integer
        description: ID del equipo
        example: 1
      - in: path
        name: jornadaId
        required: true
        schema:
          type: integer
        description: ID de la jornada
        example: 10
    responses:
      200:
        description: Equipo en jornada recuperado exitosamente.
        content:
          application/json:
            schema:
              type: object
              properties:
                message:
                  type: string
                  example: 'Equipo en jornada obtenido'
                data:
                  type: object
                  properties:
                    equipo:
                      type: object
                      properties:
                        id:
                          type: integer
                          example: 1
                        nombre:
                          type: string
                          example: 'Los Invencibles'
                        usuarioId:
                          type: integer
                          example: 5
                        usuarioNombre:
                          type: string
                          example: 'johndoe'
                    jornada:
                      type: object
                      properties:
                        id:
                          type: integer
                          example: 10
                        nombre:
                          type: string
                          example: 'Fecha 10'
                        fecha_inicio:
                          type: string
                          format: date-time
                          nullable: true
                    puntajeTotal:
                      type: number
                      nullable: true
                      example: 85.5
                      description: null si es la jornada activa
                    fechaSnapshot:
                      type: string
                      format: date-time
                    titulares:
                      type: array
                      items:
                        type: object
                        properties:
                          id:
                            type: integer
                          nombre:
                            type: string
                          nombreCompleto:
                            type: string
                          posicion:
                            type: string
                          club:
                            type: string
                          clubLogo:
                            type: string
                          foto:
                            type: string
                          esTitular:
                            type: boolean
                            example: true
                          puntaje:
                            type: number
                            nullable: true
                            example: 12.5
                          estadisticas:
                            type: object
                            nullable: true
                            properties:
                              minutos:
                                type: integer
                              rating:
                                type: number
                              goles:
                                type: integer
                              asistencias:
                                type: integer
                              golesRecibidos:
                                type: integer
                              atajadas:
                                type: integer
                              tarjetasAmarillas:
                                type: integer
                              tarjetasRojas:
                                type: integer
                              porteriaCero:
                                type: boolean
                    suplentes:
                      type: array
                      items:
                        type: object
                        properties:
                          id:
                            type: integer
                          nombre:
                            type: string
                          nombreCompleto:
                            type: string
                          posicion:
                            type: string
                          club:
                            type: string
                          clubLogo:
                            type: string
                          foto:
                            type: string
                          esTitular:
                            type: boolean
                            example: false
                          puntaje:
                            type: number
                            nullable: true
                          estadisticas:
                            type: object
                            nullable: true
      403:
        description: No tienes permiso para ver este equipo, estás expulsado del torneo, o intentas ver una jornada futura.
      404:
        description: No se encontró registro para esta jornada o equipo no encontrado.
      500:
        description: Error del servidor.

/equipos/mi-equipo/{equipoId}/vender-jugador:
  post:
    summary: Vende un jugador al mercado instantáneamente
    description: Vende un jugador del equipo devolviendo el 70% de su precio actual al presupuesto. La transacción es irreversible. Requiere que las modificaciones estén habilitadas.
    tags: [Equipos]
    parameters:
      - in: path
        name: equipoId
        required: true
        schema:
          type: integer
        description: ID del equipo
        example: 1
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - jugadorId
            properties:
              jugadorId:
                type: integer
                example: 45
                description: ID del jugador a vender
    responses:
      200:
        description: Jugador vendido exitosamente.
        content:
          application/json:
            schema:
              type: object
              properties:
                message:
                  type: string
                  example: 'Jugador vendido exitosamente'
                data:
                  type: object
                  properties:
                    jugador:
                      type: object
                      properties:
                        id:
                          type: integer
                          example: 45
                        nombre:
                          type: string
                          example: 'L. Messi'
                        precio_actual:
                          type: number
                          example: 15000000
                    devolucion:
                      type: number
                      example: 10500000
                      description: Monto devuelto al presupuesto (70% del precio actual)
                    porcentaje:
                      type: number
                      example: 70
                      description: Porcentaje del precio que se devuelve
                    presupuesto_nuevo:
                      type: number
                      example: 55500000
                      description: Presupuesto del equipo después de la venta
                    cantidad_jugadores_restantes:
                      type: integer
                      example: 14
                      description: Cantidad de jugadores que quedan en el equipo
      400:
        description: El jugador no tiene un precio válido.
      403:
        description: No tienes permisos para vender jugadores de este equipo o estás expulsado del torneo.
      404:
        description: El jugador no pertenece a tu equipo.
      500:
        description: Error del servidor.

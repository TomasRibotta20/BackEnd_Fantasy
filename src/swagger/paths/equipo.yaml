paths:
  /api/equipos:
    post:
      tags: [Equipo]
      summary: Crea un nuevo equipo para el usuario autenticado
      description: >
        Realiza un draft automático de 15 jugadores (11 titulares, 4 suplentes) y crea el equipo.
        Esta operación es transaccional. El usuario no puede tener un equipo previamente creado.
      security:
        - cookieAuth: []
        - bearerAuth: []
      requestBody:
        $ref: '#/components/requestBodies/CreateEquipo'
      responses:
        '201':
          description: Equipo creado exitosamente. Devuelve el equipo creado envuelto en un objeto con mensaje.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiEquipoCreateResponse'
        '400':
          description: Petición inválida. Falta el nombre del equipo o no hay suficientes jugadores en la base de datos para el draft.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Usuario no autenticado.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Conflicto. El usuario ya tiene un equipo creado.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/equipos/mi-equipo:
    get:
      tags: [Equipo]
      summary: Obtiene el equipo completo del usuario autenticado
      description: Devuelve el objeto del equipo del usuario con jugadores, posiciones y clubes.
      security:
        - cookieAuth: []
        - bearerAuth: []
      responses:
        '200':
          description: Equipo del usuario encontrado y devuelto.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Equipo'
        '401':
          description: Usuario no autenticado.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: No encontrado. El usuario no tiene un equipo.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/equipos/mi-equipo/intercambio:
    patch:
      tags: [Equipo]
      summary: Intercambia un jugador del equipo por uno del mercado
      description: >
        Realiza un fichaje atómico. El jugador que sale es eliminado del equipo y el que entra es añadido,
        heredando el estado de titularidad. Ambos jugadores deben ser de la misma posición.
      security:
        - cookieAuth: []
        - bearerAuth: []
      requestBody:
        $ref: '#/components/requestBodies/IntercambioJugador'
      responses:
        '200':
          description: Intercambio realizado con éxito.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OperationMessage'
        '400':
          description: Petición inválida (IDs faltantes, jugadores no pertenecen al equipo, o las posiciones no coinciden).
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Usuario no autenticado.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: No encontrado. El equipo del usuario o uno de los jugadores no existe.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Conflicto. El jugador que se intenta fichar ya está en el equipo.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/equipos/mi-equipo/alineacion:
    patch:
      tags: [Equipo]
      summary: Cambia un jugador titular por un suplente dentro del equipo
      description: >
        Intercambia el estado es_titular entre dos jugadores del mismo equipo.
        Ambos deben tener la misma posición y sus roles (titular/suplente) deben ser los correctos para el cambio.
      security:
        - cookieAuth: []
        - bearerAuth: []
      requestBody:
        $ref: '#/components/requestBodies/CambioAlineacion'
      responses:
        '200':
          description: Alineación actualizada con éxito.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OperationMessage'
        '400':
          description: Petición inválida (IDs faltantes, jugadores no pertenecen al equipo, roles incorrectos, o posiciones no coinciden).
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Usuario no autenticado.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: No encontrado. El equipo del usuario no existe.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/equipos/{equipoId}/historial:
    get:
      tags:
        - Equipo
      summary: Obtener historial de puntajes del equipo
      description: Retorna el historial completo de puntajes del equipo en todas las jornadas procesadas
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: equipoId
          required: true
          schema:
            type: number
          description: ID del equipo
          example: 1
      responses:
        200:
          description: Historial obtenido exitosamente
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Historial del equipo obtenido"
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: number
                          example: 1
                        jornada:
                          type: object
                          properties:
                            id:
                              type: number
                              example: 2
                            nombre:
                              type: string
                              example: "2nd Phase - 2"
                            temporada:
                              type: number
                              example: 2021
                            fecha_inicio:
                              type: string
                              format: date-time
                            fecha_fin:
                              type: string
                              format: date-time
                        puntajeTotal:
                          type: number
                          example: 65
                        fechaSnapshot:
                          type: string
                          format: date-time
                          example: "2025-11-08T20:44:52.000Z"
        404:
          description: Equipo no encontrado
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Equipo no encontrado"
        401:
          $ref: '#/components/responses/UnauthorizedError'

  /api/equipos/{equipoId}/jornadas/{jornadaId}:
    get:
      tags:
        - Equipo
      summary: Obtener equipo en una jornada específica
      description: |
        Retorna el snapshot del equipo en una jornada específica, incluyendo:
        - Información del equipo y jornada
        - Lista de jugadores (titulares y suplentes)
        - Puntajes individuales y estadísticas detalladas
        - Puntaje total del equipo
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: equipoId
          required: true
          schema:
            type: number
          description: ID del equipo
          example: 1
        - in: path
          name: jornadaId
          required: true
          schema:
            type: number
          description: ID de la jornada
          example: 2
      responses:
        200:
          description: Equipo en jornada obtenido exitosamente
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Equipo en jornada obtenido"
                  data:
                    type: object
                    properties:
                      equipo:
                        type: object
                        properties:
                          id:
                            type: number
                            example: 1
                          nombre:
                            type: string
                            example: "Club Atletico AntiPinguinos"
                          usuarioId:
                            type: number
                            example: 2
                      jornada:
                        type: object
                        properties:
                          id:
                            type: number
                            example: 2
                          nombre:
                            type: string
                            example: "2nd Phase - 2"
                          temporada:
                            type: number
                            example: 2021
                          fecha_inicio:
                            type: string
                            format: date-time
                          fecha_fin:
                            type: string
                            format: date-time
                      puntajeTotal:
                        type: number
                        example: 65
                        description: Puntaje total del equipo (solo jugadores titulares)
                      fechaSnapshot:
                        type: string
                        format: date-time
                        example: "2025-11-08T20:44:52.000Z"
                      jugadores:
                        type: array
                        description: Lista de jugadores ordenada (titulares primero)
                        items:
                          type: object
                          properties:
                            id:
                              type: number
                              example: 21
                            nombre:
                              type: string
                              example: "R. Rey"
                            nombreCompleto:
                              type: string
                              example: "Rodrigo Francisco Jesús Rey"
                            posicion:
                              type: string
                              example: "Goalkeeper"
                              enum: [Goalkeeper, Defender, Midfielder, Attacker]
                            club:
                              type: string
                              example: "Gimnasia L.P."
                            clubLogo:
                              type: string
                              example: "https://media.api-sports.io/football/teams/434.png"
                            foto:
                              type: string
                              example: "https://media.api-sports.io/football/players/2356.png"
                            esTitular:
                              type: boolean
                              example: true
                              description: Indica si el jugador era titular en este snapshot
                            puntaje:
                              type: number
                              example: 11.7
                              description: Puntaje del jugador en esta jornada
                            estadisticas:
                              type: object
                              nullable: true
                              description: Estadísticas del partido (null si no jugó)
                              properties:
                                minutos:
                                  type: number
                                  example: 95
                                rating:
                                  type: number
                                  format: float
                                  example: 6.7
                                goles:
                                  type: number
                                  example: 0
                                asistencias:
                                  type: number
                                  example: 0
                                golesRecibidos:
                                  type: number
                                  example: 0
                                atajadas:
                                  type: number
                                  example: 0
                                tarjetasAmarillas:
                                  type: number
                                  example: 0
                                tarjetasRojas:
                                  type: number
                                  example: 0
                                porteriaCero:
                                  type: boolean
                                  example: true
        404:
          description: No se encontró el snapshot
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "No se encontró información del equipo en esta jornada"
        401:
          $ref: '#/components/responses/UnauthorizedError'

  /api/jornadas/{jornadaId}/ranking:
    get:
      tags:
        - Jornadas
      summary: Obtener ranking de una jornada
      description: Retorna el ranking de equipos en una jornada ordenado por puntaje (mayor a menor)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: jornadaId
          required: true
          schema:
            type: number
          description: ID de la jornada
          example: 2
      responses:
        200:
          description: Ranking obtenido exitosamente
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Ranking obtenido"
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: number
                          example: 1
                        equipo:
                          type: object
                          properties:
                            id:
                              type: number
                              example: 1
                            nombre:
                              type: string
                              example: "Club Atletico AntiPinguinos"
                            usuario:
                              type: object
                              properties:
                                id:
                                  type: number
                                  example: 2
                                username:
                                  type: string
                                  example: "jugador1"
                        puntajeTotal:
                          type: number
                          example: 65
                        jornada:
                          type: object
                          properties:
                            id:
                              type: number
                              example: 2
                            nombre:
                              type: string
                              example: "2nd Phase - 2"
        401:
          $ref: '#/components/responses/UnauthorizedError'